<blockquote class="layui-elem-quote layui-text">
	图片添加
</blockquote>
<div class="layui-row">
	<form action="{:url('goods/addhanddle')}" method="post" enctype="multipart/form-data" class="layui-form">

		<div class="layui-form-item">
			<label class="layui-form-label">商品名称</label>
			<div class="layui-input-block">
				<input id="goods_name" name="goods_name" type="text"  autocomplete="off" placeholder="请输入商品名称" class="layui-input" required>
			</div>
		</div>

		<div class="layui-col-md6">
			<label class="layui-form-label">所属分类</label>
			<div class="layui-input-block" >
				<select name="goods_pid" lay-filter="" >
					{volist name="cate_list1" id="vo1"}
					<option value="{$vo1.cate_id}" disabled="">【{$vo1.cate_name}】</option>
					{volist name="vo1.children" id="vo2"}
					<option value="{$vo2.cate_id}" disabled="">&nbsp;&nbsp;&nbsp;&nbsp;{$vo2.cate_name}</option>
					{volist name="vo2.children" id="vo3"}
					<option value="{$vo3.cate_id}" selected>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$vo3.cate_name}</option>
					{/volist}
					{/volist}
					{/volist}
				</select>
			</div>
		</div>

		<div class="layui-col-md6">
			<div class="layui-form-item">
				<label class="layui-form-label">商品状态</label>
				<div class="layui-input-block">
					<input name="goods_status" type="checkbox" value="1" lay-skin="switch" lay-text="上架|下架" checked="">
				</div>
			</div>
		</div>

		<div class="layui-col-md12">
			<fieldset class="layui-elem-field layui-field-title">
				<legend>商品缩略图</legend>
			</fieldset>

			<div class="layui-upload">
				<blockquote class="layui-elem-quote layui-quote-nm" >
					<img src="__ASSETS__/images/upload.png" id="img" name="img" width="130" style="display:inline-block">
					<div class="progress" style="display:inline-block">
						<div id="thumb_progress" class="progress-bar" style="width:0%;"></div>
					</div>
					<span id="thumb_upload" class="btn btn-primary fileinput-button" style="display:inline-block">
						<span><button class="layui-btn layui-btn-sm layui-btn-primary"><i class="layui-icon">&#x1002;</i>上传</button></span>
						<input id="goods_thumb" placeholder="" class="" type="file" name="goods_thumb" >
					</span>
					<a id="thumb_cancle" href="javascript:void(0)" class="btn btn-warning" role="button" onclick="cancleUpload()" style="display:none">
						<i style="color: #ac3100" class="fa fa-trash" aria-hidden="true"></i>
					</a>
				</blockquote>
			</div>
		</div>


		<div class="layui-col-md6">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
				<legend>【jpg】</legend>
			</fieldset>

			<div class="layui-upload">
				<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
					预览图：

					<div class="progress">
						<div id="img_progress" class="progress-bar" style="width:0%;"></div>
					</div>

					<span id="img_upload" class="btn btn-primary fileinput-button">
						<span><i class="fa fa-upload" aria-hidden="true" style="font-size:2rem;color:#ff5b49"></i></span>
						<input id="goods_img" placeholder="" class="" type="file" name="goods_img" multiple="">
					</span>
					<div class="preview" style="margin-top:20px;"></div>

				</blockquote>
			</div>
		</div>


		<div class="layui-col-md6">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
				<legend>【png】</legend>
			</fieldset>

			<div class="layui-upload">
				<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
					预览图：
					<div class="progress2">
						<div id="img_progress2" class="progress-bar" style="width:0%;"></div>
					</div>
					<span id="img_upload2" class="btn btn-primary fileinput-button">
						<span><i class="fa fa-upload" aria-hidden="true" style="font-size:2rem;color:#ff5b49"></i></span>
						<input id="goods_img2" placeholder="" class="" type="file" name="goods_img2" multiple="">
					</span>
					<div class="preview2" style="margin-top:20px;"></div>
				</blockquote>
			</div>
		</div>

		<!--<div class="layui-col-md12">-->
			<!--<label for="goods_pid"> 所属分类 </label>-->
			<!--{volist name="cate_list1" id="vo1"}-->
			<!--<br>【{$vo1.cate_name}】-->
			<!--{volist name="vo1.children" id="vo2"}-->
			<!--<br>   &nbsp;&nbsp;&nbsp;&nbsp; [{$vo2.cate_name}]-->
			<!--{volist name="vo2.children" id="vo3"}-->
			<!--&#45;&#45;&#45;&#45;<input name="goods_pid" value="{$vo3.cate_id}" type="radio">{$vo3.cate_name}-->
			<!--{/volist}-->
			<!--{/volist}-->
			<!--{/volist}-->
		<!--</div>-->

		<div class="layui-col-md12">
			<button type="submit" class="layui-btn">添加商品</button>
			<button type="reset" class="layui-btn">重置</button>
		</div>

	</form>

</div>

	<!-- jqeury-file-upload -->
		<!-- <link href="__ADMIN__/css/bootstrap.min.css" rel="stylesheet">   -->
		<link rel="stylesheet" href="__JFU__/css/jquery.fileupload.css">
		<link rel="stylesheet" href="__JFU__/css/jquery.fileupload-ui.css">
		<!-- <script src="__ADMIN__/js/jquery-2.0.3.min.js"></script>  -->
		<!--<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>-->
		<script src="__JFU__/js/jquery-3.2.1.min.js"></script>
		<script src="__JFU__/js/vendor/jquery.ui.widget.js"></script>
		<script src="__JFU__/js/jquery.fileupload.js"></script>
		<script src="__JFU__/js/jquery.iframe-transport.js"></script>
		<script type="text/javascript">
		    $(function() {  
		        $("#goods_thumb").fileupload({  
		                url: '{:url("admin/goods/uploadthumb")}',  
		                sequentialUploads: true  
		            }).bind('fileuploadprogress', function (e, data) {  
		                var progress = parseInt(data.loaded / data.total * 100, 10);  
		                $("#thumb_progress").css('width',progress + '%');  
		                $("#thumb_progress").html(progress + '%');  
		            }).bind('fileuploaddone', function (e, data) {console.log(data);
		                $("#img").attr("src",data.result);
		                $("#thumb_upload").css({display:"none"}); 
		                $("#thumb_cancle").css({display:""}); 
		            }
				);
		        });
		</script>

		<script type="text/javascript">
			$(function(){
				$('#thumb_cancle').click(function(){
					$.ajax({
						url:'{:url("admin/goods/canclethumb")}',
						type:'post',
						success:function(data){
							$("#thumb_upload").css({display:""});
							$("#thumb_cancle").css({display:"none"});
							$("#thumb_progress").css('width',0);
							$("#thumb_progress").html('');
							$("#img").attr("src","__ASSETS__/images/upload.png");

						}
					});
				});
			});
		</script>
		<!-- 商品细节图 -->
		<script type="text/javascript">
		$(function(){
			$('#goods_img').fileupload({
				url:'{:url("admin/goods/imgupload")}',
				dataType: "json",
				multipart:true,
				sequentialUploads: true,
				done:function(e,data){
					$(".preview").append("<div style='margin-top:10px;display: inline-block; '><img src="+data.result+" width='60' height='60'>");
					$(".preview").append("<a class='img_cancle btn btn-warning' role='button' style=''>	 <i style=\"color: #ac3100\" class=\"fa fa-trash\" aria-hidden=\"true\"></i></a></div>");
				},

				progressall:function(e,data){
					var progress = parseInt(data.loaded / data.total * 100, 10);
					$("#img_progress").css("width", progress + "%");
					$("#img_progress").html("上传总进度："+progress+"%");
				},

				add: function(e, data) {
					var uploadErrors = [];
					var acceptFileTypes = /^image\/(jpe?g|png)$/i;
					//文件类型判断
					if(data.originalFiles[0]['type'].length && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
						uploadErrors.push('不是允许上传的文件类型');
					}
					//文件大小判断
					if(data.originalFiles[0]['size'].length && data.originalFiles[0]['size'] > 5000000) {
						uploadErrors.push('文件大小太大');
					}
					if(uploadErrors.length > 0) {
						alert(uploadErrors.join("\n"));
					} else {
						data.submit();
					}
				}
			})
		})
		</script>
		<script type="text/javascript">
			$(function(){
				$(".preview").on("click",".img_cancle",function(){
					 var index = $(".preview a").index(this);
					 var me = this;
					 $.ajax({
						data:{'index':index},
						type:"post",
						url:"{:url('admin/goods/imgcancle')}",
						success:function(data){
							$(me).prev('div').css({display:"none"});
							$(me).css({display:"none"});
						}
					 })
				})
			})
		</script>
		<!-- /商品细节图 -->



		<!--PNG-->
		<script type="text/javascript">
			$(function() {
				$("#goods_thumb2").fileupload({
					url: '{:url("admin/goods/uploadthumb2")}',
					sequentialUploads: true
				}).bind('fileuploadprogress', function (e, data) {
					var progress = parseInt(data.loaded / data.total * 100, 10);
					$("#thumb_progress2").css('width',progress + '%');
					$("#thumb_progress2").html(progress + '%');
				}).bind('fileuploaddone', function (e, data) {console.log(data);
						$("#img2").attr("src",data.result);
						$("#thumb_upload2").css({display:"none"});
						$("#thumb_cancle2").css({display:""});
					}
				);
			});
		</script>

		<script type="text/javascript">
			$(function(){
				$('#thumb_cancle2').click(function(){
					$.ajax({
						url:'{:url("admin/goods/canclethumb2")}',
						type:'post',
						success:function(data){
							$("#thumb_upload2").css({display:""});
							$("#thumb_cancle2").css({display:"none"});
							$("#thumb_progress2").css('width',0);
							$("#thumb_progress2").html('');
							$("#img2").attr("src","__ASSETS__/images/upload.png");

						}
					});
				});
			});
		</script>
		<!-- 商品细节图 -->
		<script type="text/javascript">
			$(function(){
				$('#goods_img2').fileupload({
					url:'{:url("admin/goods/imgupload2")}',
					dataType: "json",
					multipart:true,
					sequentialUploads: true,
					done:function(e,data){
						$(".preview2").append("<div style='margin-top:10px;display: inline-block; '><img src="+data.result+" width='60' height='60'>");
						$(".preview2").append("<a class='img_cancle2 btn btn-warning' role='button' style=''>	 <i style=\"color: #ac3100\" class=\"fa fa-trash\" aria-hidden=\"true\"></i></a></div>");
					},

					progressall:function(e,data){
						var progress = parseInt(data.loaded / data.total * 100, 10);
						$("#img_progress2").css("width", progress + "%");
						$("#img_progress2").html("上传总进度："+progress+"%");
					},

					add: function(e, data) {
						var uploadErrors = [];
						var acceptFileTypes = /^image\/(jpe?g|png)$/i;
						//文件类型判断
						if(data.originalFiles[0]['type'].length && !acceptFileTypes.test(data.originalFiles[0]['type'])) {
							uploadErrors.push('不是允许上传的文件类型');
						}
						//文件大小判断
						if(data.originalFiles[0]['size'].length && data.originalFiles[0]['size'] > 15000000) {
							uploadErrors.push('文件大小太大');
						}
						if(uploadErrors.length > 0) {
							alert(uploadErrors.join("\n"));
						} else {
							data.submit();
						}
					}
				})
			})
		</script>
		<script type="text/javascript">
			$(function(){
				$(".preview2").on("click",".img_cancle2",function(){
					var index = $(".preview2 a").index(this);
					var me = this;
					$.ajax({
						data:{'index':index},
						type:"post",
						url:"{:url('admin/goods/imgcancle2')}",
						success:function(data){
							$(me).prev('div').css({display:"none"});
							$(me).css({display:"none"});
						}
					})
				})
			})
		</script>
		<!-- /商品细节图 -->

		<!--PNG-->




		    <!--&lt;!&ndash; <script src="__ASSETS__/js/fuelux/data/fuelux.tree-sampledata.js"></script> &ndash;&gt;-->
		    <!--<script src="__ASSETS__/js/fuelux/fuelux.tree.min.js"></script>-->
		    <!--<script type="text/javascript">-->
			<!--jQuery(function($){-->

		<!--$('#tree1').ace_tree({-->
			<!--dataSource: treeDataSource ,-->
			<!--multiSelect:true,-->
			<!--loadingHTML:'&lt;div class="tree-loading"&gt;&lt;i class="icon-refresh icon-spin blue"&gt;&lt;/i&gt;&lt;/div&gt;',-->
			<!--'open-icon' : 'icon-minus',-->
			<!--'close-icon' : 'icon-plus',-->
			<!--'selectable' : true,-->
			<!--'selected-icon' : 'icon-ok',-->
			<!--'unselected-icon' : 'icon-remove'-->
		<!--});-->

		<!--$('#tree2').ace_tree({-->
			<!--dataSource: treeDataSource2 ,-->
			<!--loadingHTML:'&lt;div class="tree-loading"&gt;&lt;i class="icon-refresh icon-spin blue"&gt;&lt;/i&gt;&lt;/div&gt;',-->
			<!--'open-icon' : 'icon-folder-open',-->
			<!--'close-icon' : 'icon-folder-close',-->
			<!--'selectable' : false,-->
			<!--'selected-icon' : null,-->
			<!--'unselected-icon' : null-->
		<!--});-->

<!--});-->
		<!--</script>-->
			<!-- /jquery-file-upliad -->

