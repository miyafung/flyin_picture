<blockquote class="layui-elem-quote layui-text">
	图片修改
</blockquote>

<form  class="layui-form" action="{:url('goods/updhanddle')}" method="post" enctype="multipart/form-data">
		<input type="hidden" name="goods_id" value="{$goods_find.goods_id}">

		<div class="layui-form-item">
				<label class="layui-form-label">商品名称</label>
				<div class="layui-input-block">
					<input id="goods_name" name="goods_name" type="text"  autocomplete="off" placeholder="请输入商品名称" class="layui-input" value="{$goods_find.goods_name}">
				</div>
		</div>


	<div class="layui-form-item layui-col-md6">
		<label class="layui-form-label">所属分类</label>
		<div class="layui-input-block">
			<select name="goods_pid" lay-filter="">
				{volist name="cate_list1" id="vo1"}
				<option disabled="">【{$vo1.cate_name}】</option>
				{volist name="vo1.children" id="vo2"}
				<option disabled="">&nbsp;&nbsp;&nbsp;&nbsp;{$vo2.cate_name}</option>
				{volist name="vo2.children" id="vo3"}
				<option name="property_pid" value="{$vo3.cate_id}" type="text"
						{if condition="$goods_find.goods_pid eq $vo3.cate_id"}
						selected=""
						{/if}
				/>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$vo3.cate_name}
				{/volist}
				{/volist}
				{/volist}
			</select>
		</div>
	</div>


	<div class="layui-col-md6">
		<div class="layui-form-item">
			<label class="layui-form-label">商品状态</label>
			<div class="layui-input-block">
				<input name="goods_status"  type="checkbox" value="1" lay-skin="switch" lay-text="上架|下架"
					   {if condition="$goods_find.goods_status eq 1"}
					   checked="true"
					   {else/}
				{/if}>
			</div>
		</div>
	</div>


		<div class="layui-col-md12">
			<div class="form-group ">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
					<legend>商品缩略图</legend>
				</fieldset>
				<div class="layui-upload">
					<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
						预览图：
						<img src="{$goods_find.goods_thumb}" id="img" name="img" width="100" height="100" style="display:inline-block">
						<div class="progress" style="display:inline-block">
							<div id="thumb_progress" class="progress-bar" style="width:0%;"></div>
						</div>
						<span id="thumb_upload" class="btn btn-primary fileinput-button" style="display:inline-block">
						<span>
							<button class="layui-btn layui-btn-sm layui-btn-primary"><i class="layui-icon">&#x1002;</i>替换</button>
						</span>
					<input id="goods_thumb" placeholder="" class="" type="file" name="goods_thumb">
				</span>

					</blockquote>
				</div>
			</div>
		</div>

		<div class="layui-col-md6">
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
					<legend>【jpg】</legend>
				</fieldset>
				<div class="layui-upload">
					<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
						预览图：
						<div class="progress">
							<div id="img_progress" class="progress-bar" style="width:0%;"></div>
						</div>
						<!--<div class="layui-upload-list" id="demo2"></div>-->

						<span id="img_upload" class="btn btn-primary fileinput-button">
						<span><i class="fa fa-upload" aria-hidden="true" style="font-size:2rem;color:#ff5b49"></i></span>
						<input id="goods_img" placeholder="" class="" type="file" name="goods_img" multiple="">
						</span>

						<div class="preview " style="margin-top:20px;">
							{volist name="img_select" id="vo"}
							<div style='padding:2px;margin:2px;display: inline-block; border:2px dashed #c0c0c0;'>
							<!--<div class="layui-upload-list" style="display: inline-block">-->
								<img src="{$vo.url}" width='60' height="60">
								<a class='img_cancle btn btn-warning' role='button' >
									<i style="color: #ac3100" class="fa fa-trash" aria-hidden="true"></i>
								</a>
							</div>
							{/volist}
						</div>
					</blockquote>
				</div>
		</div>
		<div class="layui-col-md6">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
				<legend>【png】</legend>
			</fieldset>

			<div class="layui-upload">
				<blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
					预览图2：
					<div class="progress2">
						<div id="img_progress2" class="progress-bar" style="width:0%;"></div>
					</div>
					<!--<div class="layui-upload-list" id="demo2"></div>-->

					<span id="img_upload2" class="btn btn-primary fileinput-button">
						<span><i class="fa fa-upload" aria-hidden="true" style="font-size:2rem;color:#ff5b49"></i></span>
						<input id="goods_img2" placeholder="" class="" type="file" name="goods_img2" multiple="">
						</span>

					<div class="preview2" style="margin-top:20px;">
						{volist name="img_select2" id="vo"}
						<div style='padding:2px;margin:2px;display: inline-block; border:2px dashed #c0c0c0;'>
							<img src="{$vo.url}" width='60' height="60">
							<a class='img_cancle2 btn btn-warning' role='button' >
								<i style="color: #ac3100" class="fa fa-trash" aria-hidden="true"></i>
							</a>
						</div>
						{/volist}
					</div>
				</blockquote>
			</div>
		</div>

	<div class="layui-col-md6">
		<button type="submit" class="layui-btn">修改商品</button>
		<button type="reset" class="layui-btn">重置</button>
	</div>
	</form>

	<!-- jqeury-file-upload -->
		<!-- <link href="__ADMIN__/css/bootstrap.min.css" rel="stylesheet">   -->
		<link rel="stylesheet" href="__JFU__/css/jquery.fileupload.css">  
		<link rel="stylesheet" href="__JFU__/css/jquery.fileupload-ui.css"> 
		<!-- <script src="__ADMIN__/js/jquery-2.0.3.min.js"></script>  -->
		<script src="__JFU__/js/jquery-3.2.1.min.js"></script>
		<script src="__JFU__/js/vendor/jquery.ui.widget.js"></script>  
		<script src="__JFU__/js/jquery.fileupload.js"></script>  
		<script src="__JFU__/js/jquery.iframe-transport.js"></script>  

		<script type="text/javascript">
		    $(function() {  
		        $("#goods_thumb").fileupload({  
		                url: '{:url("admin/goods/uploadthumb")}',  
		                sequentialUploads: true  
		            }).bind('fileuploadprogress', function (e, data) {  
		                var progress = parseInt(data.loaded / data.total * 100, 10);  
		                $("#thumb_progress").css('width',progress + '%');  
		                $("#thumb_progress").html(progress + '%');  
		            }).bind('fileuploaddone', function (e, data) {console.log(data);
		                $("#img").attr("src",data.result);  
		                // $("#thumb_upload").css({display:"none"}); 
		                // $("#thumb_cancle").css({display:""}); 
		            });  
		                 
		        });
		    </script>

		    <script type="text/javascript">
		    	$(function(){
		    		$('#thumb_cancle').click(function(){
		    			$.ajax({
		    				url:'{:url("admin/goods/canclethumb")}',
		    				type:'post',
		    				success:function(data){
		    					$("#thumb_upload").css({display:""}); 
		                		$("#thumb_cancle").css({display:"none"});
								$("#thumb_progress").css('width',0);
								$("#thumb_progress").html('');
		                		$("#img").attr("src","__ADMIN__/assets/images/upload.png");  
		    				}
		    			})
		    		});
		    	});
		    </script>

		    <!-- 商品细节图 -->
		    <script type="text/javascript">
			$(function(){
				$('#goods_img').fileupload({
					url:'{:url("admin/goods/imgupload")}',
					dataType: "json",   
				    multipart:true,
				    sequentialUploads: true,
				    done:function(e,data){
				    	$(".preview").append("<div style='padding:2px;margin:2px;display: inline-block; border:2px dashed #c0c0c0;'><img src="+data.result+" width='60' style='height: 60;width: 60;'><a class='img_cancle btn btn-warning' role='button' style=''><i style=\"color: #ac3100\" class=\"fa fa-trash\" aria-hidden=\"true\"></i></a></div>");
				    },
				    progressall:function(e,data){
				    	var progress = parseInt(data.loaded / data.total * 100, 10);  
				        $("#img_progress").css("width", progress + "%");  
				        $("#img_progress").html("上传总进度："+progress+"%"); 
				    }
				})
			})
			</script>
			<script type="text/javascript">
				$(function(){
					$(".preview").on("click",".img_cancle",function(){
						 var index = $(".preview a").index(this);
						 var me = this;
			   			 $.ajax({
			   			 	data:{'index':index},
			   			 	type:"post",
			   			 	url:"{:url('admin/goods/imgcancle')}",
			   			 	success:function(data){
			   			 		$(me).prev('div').css({display:"none"});
			   			 		$(me).prev('img').css({display:"none"});
			   			 		$(me).css({display:"none"});
			   			 	}
			   			 })
					})
				})
			</script>
			<!-- /商品细节图 -->

			<!-- 商品细节图2 -->
			<script type="text/javascript">
				$(function(){
					$('#goods_img2').fileupload({
						url:'{:url("admin/goods/imgupload2")}',
						dataType: "json",
						multipart:true,
						sequentialUploads: true,
						done:function(e,data){
							$(".preview2").append("<div style='padding:2px;margin:2px;display: inline-block; border:2px dashed #c0c0c0;'><img src="+data.result+" width='60' style='height: 60;width: 60;'><a class='img_cancle2 btn btn-warning' role='button' style=''><i style=\"color: #ac3100\" class=\"fa fa-trash\" aria-hidden=\"true\"></i></a></div>");
						},
						progressall:function(e,data){
							var progress = parseInt(data.loaded / data.total * 100, 10);
							$("#img_progress2").css("width", progress + "%");
							$("#img_progress2").html("上传总进度："+progress+"%");
						}
					})
				})
			</script>
			<script type="text/javascript">
				$(function(){
					$(".preview2").on("click",".img_cancle2",function(){
						var index = $(".preview2 a").index(this);
						var me = this;
						$.ajax({
							data:{'index':index},
							type:"post",
							url:"{:url('admin/goods/imgcancle2')}",
							success:function(data){
								$(me).prev('div').css({display:"none"});
								$(me).prev('img').css({display:"none"});
								$(me).css({display:"none"});
							}
						})
					})
				})
			</script>



